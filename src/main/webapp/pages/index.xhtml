<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich">

    <head>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
        <script src="http://code.highcharts.com/stock/highstock.js"></script>
        <script src="http://code.highcharts.com/highcharts.js"></script>
        <script src="http://code.highcharts.com/modules/exporting.js"></script>
        <script type="text/javascript">
            function renderChart(divId, chartType, chartTitle, chartData, categories){
                var options = createOption(divId, chartType, chartTitle, categories);
                //console.log(chartData);
                options.series = $.parseJSON(chartData);
                //chart.xAxis[0].setCategories($.parseJSON(categories));
                var chart = new Highcharts.Chart(options);
            }
            
            function createOption(divId, chartType, chartTitle, categories){
                var options = {
                    chart: {
                        renderTo: divId,
                        type: chartType
                    },
                    title: {
                        text: 'JVM Heap Memory Usage Chart'
                    },
                    subtitle: {
                        text: 'Source: http://java-bytes.blogspot.com'
                    },
                    xAxis: {
                        categories: categories,
                        labels: {
                            formatter: function() {
                                return this.value;
                            }
                        }
                    },
                    yAxis: {
                        title: {
                            text: 'Heap Memory Usage'
                        },
                        labels: {
                            formatter: function() {
                                return this.value +'MB';
                            }
                        }
                    },
                    plotOptions: {
                        area: {
                            stacking: 'normal',
                            lineColor: '#666666',
                            lineWidth: 1,
                            marker: {
                                lineWidth: 1,
                                lineColor: '#666666'
                            }
                        }
                    },
                    tooltip: {
                        formatter: function() {
                            return ''+ this.x +': '+ Highcharts.numberFormat(this.y, 0, ',') +' MB';
                        }
                    },
                    series: []
                };
                
                return options; 
            }
        </script>
    </head>

    <body>
        <h:form prependId="false">
            <a4j:poll interval="5000" oncomplete="renderChart('container','area','Sample Chart', '${chartController.chartData}', '${chartController.categories}');" 
                      action="#{chartController.loadChartData}" id="chartvalue_btn" />

            <div id="container" style="width: 100%; height: 500px"></div>
        </h:form>
    </body>
</html>